# Run ESLint
npm run lint

# Run tests
npm test

# Run local secret scanner (Node script - cross-platform)
if command -v node >/dev/null 2>&1 ; then
  echo "Running local secret scanner..."
  node scripts/check-secrets.cjs
  RC=$?
  if [ $RC -ne 0 ]; then
    echo "Commit blocked: local secret scanner found possible secrets. Fix staged changes and try again."
    exit $RC
  fi
else
  echo "Node not found; skipping local secret scanner. Ensure you have Node.js installed to enable secret scanning."
fi

# Run security audit
npm audit

# Verify no .env file is being committed
if git diff --cached --name-only | grep -q "^.env$"
then
  echo "Error: Attempting to commit .env file"
  exit 1
fi
